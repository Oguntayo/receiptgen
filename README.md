# ReceiptGen - E-Commerce Receipt Generator

ReceiptGen is a robust .NET web application designed for small businesses to manage stores, products, and automatically generate professional PDF receipts with email delivery and S3 storage.

## Getting Started

### Prerequisites
- [.NET 10.0 SDK](https://dotnet.microsoft.com/download/dotnet/10.0)
- [PostgreSQL](https://www.postgresql.org/) (Local or Cloud like Supabase)
- [AWS Account](https://aws.amazon.com/) (For S3 storage)
- [Gmail Account](https://mail.google.com/) (Or any SMTP provider for emails)

### 1. Setup Locally

1. **Clone the repository:**
   ```bash
   git clone https://github.com/Oguntayo/receiptgen.git
   cd receiptgen/ReceiptGen
   ```

2. **Configure Environment:**
   Create an `appsettings.json` file in the root directory (one is provided as a template in the repo's history or below):
   ```json
   {
     "ConnectionStrings": {
       "DefaultConnection": "Host=your_host;Database=your_db;Username=your_user;Password=your_password"
     },
     "Jwt": {
       "Key": "YourSuperSecretKeyAtLeast32CharsLong",
       "Issuer": "ReceiptGenApp",
       "Audience": "ReceiptGenUsers"
     },
     "EmailSettings": {
       "Email": "your_email@gmail.com",
       "Password": "your_app_password",
       "Host": "smtp.gmail.com",
       "Port": 465
     },
     "AWS": {
       "AccessKey": "YOUR_AWS_ACCESS_KEY",
       "SecretKey": "YOUR_AWS_SECRET_KEY",
       "Region": "us-east-1",
       "BucketName": "your-bucket-name"
     }
   }
   ```

3. **Install Dependencies & Run Migrations:**
   ```bash
   dotnet restore
   dotnet ef database update
   ```

4. **Run the Application:**
   ```bash
   dotnet run
   # Or using the watch script
   ./run_watch.sh
   ```
   The app will be available at `http://localhost:5046` (Default).

### 2. Run with Docker

1. **Build the image:**
   ```bash
   docker build -t receiptgen .
   ```

2. **Run the container:**
   ```bash
   docker run -d -p 8080:8080 --name receiptgen -e ConnectionStrings__DefaultConnection="Your_DB_String" receiptgen
   ```
   The app will be accessible at `http://localhost:8080`.

---

## ðŸŒ Deploying to Render

### 1. Repository Access
Ensure your project is pushed to GitHub (as you've already done).

### 2. Create Web Service
1. Log in to [Render](https://dashboard.render.com/).
2. Click **New +** and select **Web Service**.
3. Connect your GitHub repository (`Oguntayo/receiptgen`).
4. **Project Settings**:
   - **Language**: `Docker`
   - **Region**: Select the one closest to your DB.
   - **Instance Type**: `Free` or `Starter`.

### 3. Environment Variables
In the **Environment** tab of your Render service, add the following keys (copy values from your `appsettings.json`):
- `ConnectionStrings__DefaultConnection`
- `Jwt__Key`
- `Jwt__Issuer`
- `Jwt__Audience`
- `EmailSettings__Email`
- `EmailSettings__Password`
- `EmailSettings__Host`
- `EmailSettings__Port`
- `AWS__AccessKey`
- `AWS__SecretKey`
- `AWS__Region`
- `AWS__BucketName`
- `ASPNETCORE_ENVIRONMENT`: `Production`

### 4. Deploy
Render will automatically detect the `Dockerfile` in your root or subdirectory (if configured) and start the build.

---

## ðŸ›  Usage Guide

### Business Flow (Merchant)
1. **Registration**: Register a new account via `/api/Auth/register`.
2. **Setup Store**: Go to `/api/Store/create` to create your business store. This automatically upgrades your account to **Business** role.
3. **Add Products**: Use `/api/Product` endpoints to add products to your store.
4. **View Orders**: Access `/api/Orders/history` to see all orders placed across your stores.
5. **Manage Receipts**: Access `/api/Receipts` to see and download generated receipts for your sales.

### Customer Flow
1. **Registration**: Register as a customer.
2. **Browse & Checkout**: Use `/api/Orders/checkout` to place an order by providing Product IDs and quantities.
3. **Order History**: Use `/api/Orders/history` to view your own purchase history.
4. **Get Receipts**: Use `/api/Receipts` to get access to your generated PDF receipts (stored securely on S3).

---

##  Security & Privacy

### Configuration
Sensitive files like `appsettings.json` and `appsettings.Development.json` are **excluded from Git tracking** via `.gitignore`. 
> [!IMPORTANT]
> A security audit was performed on Feb 2, 2026, confirming that no secrets were pushed to the public repository.

### S3 Storage
All receipts are stored in a **private S3 bucket**. Access links generated by the API are **pre-signed** and valid for only 1 hour, ensuring your customers' data remains secure.
